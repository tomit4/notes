(()=>{"use strict";const e="mnojpmjdmbbfmejpflffifhffcmidifd";let t=null;const n=()=>t,i=(e,n)=>{e&&t&&t.postMessage({type:"GreaselionError",mediaType:e,data:{errorMessage:n}})},a=()=>"complete"===document.readyState&&"visible"===document.visibilityState,o=(RegExp(/&(?:amp|lt|gt|quot|#(0+)?39);/g.source),"github"),s=()=>{const e=new URL(location.href);var t;t=e.pathname,["/","/about","/enterprise","/events","/explore","/home","/issues","/login","/logout","/marketplace","/nonprofit","/notifications","/pricing","/pulls","/search","/settings","/team","/tos"].includes(t)?(()=>{const e=n();e&&e.postMessage({type:"SavePublisherVisit",mediaType:"",data:{url:"https://github.com",publisherKey:"github.com",publisherName:"github.com",mediaKey:"",favIconUrl:""}})})():(e=>{const t=(e=>{if(!e.pathname)return"";const t=e.pathname.split("/").filter((e=>e));return t&&0!==t.length?t.length>1&&"orgs"===t[0]?t[1]:t[0]:""})(e);if(t)return(async e=>{if(!e)throw new Error("Invalid parameters");const t=(e=>e?`https://api.github.com/users/${e}`:"")(e);if(!t)throw new Error("Invalid profile api url");const n=await fetch(t);if(!n.ok){const e=((e,t)=>`Profile API request failed: ${t.statusText} (${t.status})`)(0,n);throw new Error(e)}const i=await n.json();return{user:{id:i.id,screenName:i.login,fullName:i.name||i.login,favIconUrl:i.avatar_url},post:{id:"",timestamp:"",text:""}}})(t).then((e=>{const a=e.user.id,s=((e,t)=>`${e}#channel:${t}`)(o,a),r=e.user.fullName;if(!r)return void i(o,"Invalid publisher name");const c=((e,t)=>e&&t?`${e}_${t}`:"")(o,t),l=e.user.favIconUrl,u=(e=>e?`https://github.com/${e}/`:"")(t),m=n();m&&m.postMessage({type:"SavePublisherVisit",mediaType:o,data:{url:u,publisherKey:s,publisherName:r,mediaKey:c,favIconUrl:l}})}));i(o,"Invalid screen name")})(e)};let r=!1,c="";const l=e=>{e&&(e.url||"complete"===e.status)&&location.href!==c&&(c=location.href,s())};var u;chrome.extension.inIncognitoContext||(u=e=>{e?(a()?s():document.addEventListener("readystatechange",(function(){a()&&s()})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&s()})),((e,t)=>{if(!e||r)return;r=!0;const i=n();i&&(i.postMessage({type:"RegisterOnUpdatedTab",mediaType:e}),i.onMessage.addListener((function(e){e.data&&"OnUpdatedTab"===e.type&&t(e.data.changeInfo)})))})(o,l)):console.error("Failed to initialize communications port")},t?u(!0):(chrome.runtime.sendMessage(e,{type:"SupportsGreaselion"},(function(n){!chrome.runtime.lastError&&n&&n.supported&&(t=chrome.runtime.connect(e,{name:"Greaselion"}),u(!0))})),setTimeout((()=>{t||(t=chrome.runtime.connect("jidkidbbcafjabdphckchenhfomhnfma",{name:"Greaselion"}),u(!0))}),100)),console.info("Greaselion script loaded: githubBase.ts"))})();